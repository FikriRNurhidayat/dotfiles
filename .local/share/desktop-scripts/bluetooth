#!/bin/sh

powered=$(bluetoothctl show | grep "Powered:" | awk '{ print $2 }')

if [ "$powered" != "yes" ]; then
  choice=$(printf "No\nYes" | rofi -dmenu -p "Bluetooth")
  [ "$choice" = "Yes" ] && bluetoothctl power on && dunstify "Bluetooth is ON"
fi

device=$(bluetoothctl devices | sed 's/^Device [^ ]* //g' | rofi -dmenu -p "Device")

if [ -n "$device" ]; then
  device_id=$(bluetoothctl devices | grep "$device" | awk '{print $2}')
  
  action=$(echo -e "Pair\nTrust\nConnect" | rofi -dmenu -p "Action")
  
  case "$action" in
    "Pair")
      bluetoothctl pair "$device_id"
      notify-send "Bluetooth" "$device paired successfully."
      ;;
    "Trust")
      bluetoothctl trust "$device_id"
      notify-send "Bluetooth" "$device trusted successfully."
      ;;
    "Connect")
      bluetoothctl connect "$device_id"
      notify-send "Bluetooth" "$device connected successfully."
      ;;
    *)
      echo "No action selected."
      ;;
  esac
fi
